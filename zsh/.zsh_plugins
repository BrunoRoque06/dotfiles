#!/usr/bin/env bash

readonly ZSH_PLUGINS="$HOME/.zsh_plugs"
readonly FPATH_PLUGINS="/usr/local/share/zsh/site-functions"

readonly PURE_PROMPT_SYMBOL='$'
readonly PURE_GIT_DOWN_ARROW='▼'
readonly PURE_GIT_UP_ARROW='▲'

_download_file() {
  (cd "$ZSH_PLUGINS"; curl -O "$1")
}

_clone_or_pull() {
  REPO=$(basename "$1" .git)
  DIR="$2"/"$REPO"
  mkdir -p "$DIR"
  git -C "$DIR" pull --depth 1 || git clone --depth 1 "$1" "$DIR"
}

zsh_plugins_install() {
  mkdir -p "$ZSH_PLUGINS"

  _download_file https://raw.githubusercontent.com/rupa/z/master/z.sh

  _download_file https://raw.githubusercontent.com/sindresorhus/pure/master/pure.zsh
  ln -fsv "$ZSH_PLUGINS"/pure.zsh "$FPATH_PLUGINS"/prompt_pure_setup
  _download_file https://raw.githubusercontent.com/sindresorhus/pure/master/async.zsh
  ln -fsv "$ZSH_PLUGINS"/async.zsh "$FPATH_PLUGINS"/async

  _clone_or_pull https://github.com/zsh-users/zsh-completions.git "$ZSH_PLUGINS"
  _clone_or_pull https://github.com/zsh-users/zsh-syntax-highlighting.git "$ZSH_PLUGINS"
  _download_file https://raw.githubusercontent.com/zsh-users/zsh-autosuggestions/master/zsh-autosuggestions.zsh
  _download_file https://raw.githubusercontent.com/zsh-users/zsh-history-substring-search/master/zsh-history-substring-search.zsh
}

zsh_plugins_load() {
  fpath=($ZSH_PLUGINS/zsh-completions/src $fpath)
  autoload -Uz compinit; compinit
  autoload -Uz promptinit; promptinit
  prompt pure
  source "$ZSH_PLUGINS"/z.sh
  source "$ZSH_PLUGINS"/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
  source "$ZSH_PLUGINS"/zsh-autosuggestions.zsh
  source "$ZSH_PLUGINS"/zsh-history-substring-search.zsh
}
