#!/usr/bin/env bash

# Paths
readonly MR="$HOME/Documents/dm"
readonly LOCAL_LOGISTICS="$MR/development/local-logistics/logistics.yml"

# Bazel Targets
readonly ALL='//... -//sdm/auth:acceptance_tests -//sdm/logistics/test:api_regression_tests'
readonly BENCHMARK='//sdm/logistics/client/benchmark:app'
readonly CLI='//sdm/logistics/client/cli:sdm-cli'
readonly COMPOSITE='//sdm/logistics/app/composite:docker_image'
readonly COMPOSITE_IMAGE='bazel/sdm/logistics/app/composite:docker_image'

# CLI
cli_local() { (cd "$MR" || exit; bazel run "$CLI" -- -server_url localhost:6063 "$@") }
alias lgp='cli_local -get_profiles'
alias lgg='cli_local -get_graphs'
alias lgrg='cli_local -get_running_graphs'

# Gerrit
readonly GERRIT_MASTER='gerrit/master'
gecob() { git checkout -b "$1" "$GERRIT_MASTER"; }
ged() { git diff --color gerrit/master.."$1" | diff-so-fancy; }
alias gepr='git push gerrit HEAD:refs/for/master -o topic=$(git rev-parse --abbrev-ref HEAD)'
alias gerb='git stash; git rebase $GERRIT_MASTER; git stash pop'
alias geud='git remote update gerrit --prune'
alias gewip='git push gerrit HEAD:refs/for/master%wip -o topic=$(git rev-parse --abbrev-ref HEAD)'

# Logistics
alias leup='dclean; dcfu $LOCAL_LOGISTICS zookeeper kafka redis'
alias lup='(cd $MR; bazel run $COMPOSITE; dcfu $LOCAL_LOGISTICS)'
alias ldown='docker-compose -f $LOCAL_LOGISTICS down'
lbench() { (cd "$MR" || exit; bazel run "$BENCHMARK" -- "$@") }
alias lunit='(cd $MR; bazel test //sdm/logistics/service:unit_tests)'

# Mono Commands
alias mrcd='cd $MR'
alias mrb='(cd $MR; bazel build //...)'
alias mrt="(cd $MR; bazel test -- $ALL)"

# SDK
alias sdkut='bazel test //sdm/logistics/client/connector-sdk/java/base:unit_tests'

