#!/usr/bin/env bash

# Paths
readonly MR="$HOME/Documents/dm"
readonly LOCAL_LOGISTICS="$MR/sdm/local_environment/"

# Gerrit
readonly GERRIT_MASTER='gerrit/master'
alias geco='git checkout $GERRIT_MASTER'
gecob() { git checkout -b "$1" "$GERRIT_MASTER"; }
ged() { git diff --color gerrit/master.."$1" | diff-so-fancy | less -RFX; }
alias gepr='git push gerrit HEAD:refs/for/master -o topic=$(git rev-parse --abbrev-ref HEAD)'
alias gerb='git stash; git rebase $GERRIT_MASTER; git stash pop'
alias geud='git remote update gerrit --prune'
alias gewip='git push gerrit HEAD:refs/for/master%wip -o topic=$(git rev-parse --abbrev-ref HEAD)'

# Logistics
alias lbc='(cd $MR; bazel run //sdm/logistics/test:persistence_regression_docker_push; bazel run //sdm/logistics/test:acceptance_tests_docker_push; bazel build //sdm/logistics/test:upload_redis_dump)'
alias leup='(cd $LOCAL_LOGISTICS; dclean; docker-compose up zookeeper kafka redis)'
alias lup='(cd $LOCAL_LOGISTICS; bazel run //sdm/logistics/app/composite:docker_image; dclean; docker-compose up)'
alias ldown='(cd $LOCAL_LOGISTICS; docker-compose down)'
lbench() { (cd "$MR" || exit; bazel run //sdm/logistics/client/benchmark:app -- "$@") }

# Logistics CLI
lcli() { (cd "$MR" || exit; bazel run //sdm/logistics/client/cli:sdm-cli -- -server_url "$LOGISTICS_URL" -ssl_key "$LOGISTICS_SSL" "$@") }

# Mono Repository
alias mrcd='cd $MR'
alias mrb='(cd $MR; bazel build //example/... //sdm/...)'
alias mrt='(cd $MR; bazel test -- //sdm/... -//sdm/auth/... -//sdm/logistics/test:api_regression_tests -//sdm/logistics/test:persistence_regression_tests -//sdm/logistics/test:smoke_tests)'

# Spoud Data Market
alias sdmui='(cd $MR/sdm/logistics/api; npm ci; npm run compile; cd $MR/sdm/market/client/wolverine-ui; npm ci; npm run start)' 

